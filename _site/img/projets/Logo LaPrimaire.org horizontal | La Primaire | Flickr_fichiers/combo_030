YUI.add("photo-well-view",function(e,t){var n=require("lib/flog")(t),r=1,i=5;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.isAd=!!t.ad,this.firstLoad=!!t.firstLoad,this.publisherUrl=t.publisherUrl,t.isFluid=!0,t.isOnDark=!0,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"photo-well-media-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-sidebar-toggle-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen","photo-attribution"]},"photo-sidebar-actions-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen"],disabled:function(){return this.appContext.experiments.fullscreen.disableRealFullscreenButtons()}},"people-notes-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:!0}},buildContainer:function(){var e=this,t="",n,r=0,i,s,o=".navigate-prev",u=".navigate-next",a,f,l,c;return this.firstLoad||(this.subviews["photo-sidebar-actions-view"]&&this.subviews["photo-sidebar-actions-view"].get("container").addClass("is-hidden"),this.subviews["photo-sidebar-toggle-view"]&&this.subviews["photo-sidebar-toggle-view"].get("container").addClass("is-hidden")),this.appContext.experiments.fullscreen.getMode()?this.subviews["attribution-view"]&&(YUI.Env.isServer||this.subviews["attribution-view"].get("container").removeClass("is-always-hidden"),!this.firstLoad&&this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&this.subviews["attribution-view"].get("container").addClass("is-hidden"),t=this.subviews["attribution-view"].get("container")):this.subviews["attribution-view"]&&(this.subviews["attribution-view"].get("container").addClass("is-always-hidden"),t=this.subviews["attribution-view"].get("container")),this.get("contextModel")&&(n=this.get("contextModel").getValue("photoContextList").getList(),n.length>2&&n.some(function(t){return r++,t.getValue("id")===e.photoId})&&(i=n.slice(r-2,r-1),s=n.slice(r,r+1),i&&i.length>0&&(a=e.setupNavLink(i[0],o,"previous"),i[0].getValue("owner")&&(i[0].getValue("title").trim()===""?l=e.intlMessage({intlName:"common.UNTITLED"}):l=i[0].getValue("title"),l+=" | "+e.intlMessage({intlName:"common.BY_USER",user:i[0].getValue("owner").getValue("username")}))),s&&s.length>0&&(f=e.setupNavLink(s[0],u,"next"),s[0].getValue("title").trim()===""?c=e.intlMessage({intlName:"common.UNTITLED"}):c=s[0].getValue("title"),c+=" | "+e.intlMessage({intlName:"common.BY_USER",user:s[0].getValue("owner").getValue("username")})))),this.setContainerWithTemplate("photo-well",{"is-video":this.get("photo").getValue("isVideo"),"is-hidden":(YUI.Env.isServer||!this.firstLoad)&&!a&&!f,"prev-is-not-clickable":!a,"next-is-not-clickable":!f,"prev-url":a,"next-url":f,"prev-title":l,"next-title":c,"is-ad":this.isAd,"opt-out-enabled":this.appContext.experiments.optOut.enabled(),"attribution-view":t,enableZoom:!0}),YUI.Env.isServer&&(this.serverWidth=this.subviews["photo-well-media-view"].serverWidth,this.serverHeight=this.subviews["photo-well-media-view"].serverHeight),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){if(!e)throw new Error("[photo-well-view] Invalid photoModel returned from getModel");t.set("photo",e)})),this.contextData&&this.contextData.modelName&&this.contextData.params&&n.push(this.appContext.getModelRegistry(this.contextData.modelName).then(function(e){var n;if(e){n=e.attributeSearch(t.contextData.params);if(n&&n.length&&e.exists(n[0]))return t.appContext.getModel(t.contextData.modelName,n[0]).then(function(e){e&&t.set("contextModel",e)})}}).then(null,function(){return"whatever"})),e.Promise.all(n)},setLinkAsAdFriendly:function(e){var t=e.currentTarget;t.hasClass("navigate-next")?this.appContext.adManager.setAdCouldBeShown(!0,"next",t.getAttribute("href")):this.appContext.adManager.setAdCouldBeShown(!0,"previous",t.getAttribute("href"))},animateNavigation:function(){var t=e.all(".navigate-target"),n=this.get("container"),r=n.one(".photo-sidebar-toggle-view"),i=n.one(".attribution-view"),s=1500,o=250,u=!1,a=!1,f,l=!0,c=this;s=(s-500)/2,u=!0,a=this.appContext.experiments.fullscreen.getMode(),this.registerEventHandler(this.get("container").on("mousemove",e.betterThrottle(function(e){f=n.one(".photo-sidebar-actions-view"),t&&l&&t.removeClass("is-hidden"),u&&l&&(f&&f.removeClass("is-hidden"),r&&r.removeClass("is-hidden"),i&&i.removeClass("is-hidden")),clearTimeout(c.movingTimeout),clearTimeout(c.initialTimeout),l=!0,c.followViewOpen||(c.movingTimeout=setTimeout(c.hideUI.bind(c),s*2))},o))),!this.firstLoad&&this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&(l=!1),c.initialTimeout=setTimeout(function(){l=!0,f=n.one(".photo-sidebar-actions-view"),t&&c.firstLoad&&t.addClass("is-hidden"),u&&l&&(f&&f.addClass("is-hidden"),r&&r.addClass("is-hidden"),i&&i.addClass("is-hidden"))},s*2)},hideUI:function(){var e=this.get("container"),t=e.one(".photo-sidebar-actions-view"),n=e.one(".photo-sidebar-toggle-view"),r=e.one(".attribution-view");t&&t.addClass("is-hidden"),n&&n.addClass("is-hidden"),r&&r.addClass("is-hidden")},onSubviewEvent:function(e,t){var n=1500;n=(n-500)/2,e==="attribution-view"&&t[0]==="isOpen"?(this.followViewOpen=!0,clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout)):e==="attribution-view"&&t[0]==="isClosed"&&(this.followViewOpen=!1,this.movingTimeout=setTimeout(this.hideUI.bind(this),n*2))},activate:function(){var t=this,s=this.contextData,o=0,u,a,f,l,c=".navigate-prev",h=".navigate-next";return YUI.Env.isServer||(a=e.getLocation(),f=a.protocol,l=a.hostname,t.appContext.getModel(s.modelName,s.params).then(function(e){t.set("contextModel",e)
},function(n){if(!n.getModelFailure&&n.code!==1||s.modelName==="photostream-models")throw e.all(c).hide(),e.all(h).hide(),n;return t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.appContext.getModel("photostream-models",t.contextData.params).then(function(e){t.set("contextModel",e)})}).then(function(){var n=t.get("contextModel").getValue("photoContextList"),r=n.getList(),i,u,a,p,d;return r.length>2&&r.some(function(e){return o++,e.getValue("id")===t.photoId})&&(u=r.slice(o-2,o-1),a=r.slice(o,o+1),u&&u.length>0&&(p=t.setupNavLink(u[0],c,"previous"),p&&(t.updateNavLinks(c,f,l,p),t.get("container").all(c).removeClass("no-click"))),a&&a.length>0&&(d=t.setupNavLink(a[0],h,"next"),d&&(t.updateNavLinks(h,f,l,d),t.get("container").all(h).removeClass("no-click")))),i=e.merge(s.params,{photoId:t.photoId,numNext:10,numPrev:10}),n.getContext(i)}).then(function(n){function s(s,o){var u=t.get("container").all(s),a,c,h,p,d,v,m=n&&n[o]&&n[o].length;if(!u.size())return;if(!m){u.remove();return}u.removeClass("no-click"),a=t.setupNavLink(n[o][0],s,o);if(t.isAd)h=t.appContext.adManager.origin,o===h.arrow?(u.setAttribute("href",h.url),u.removeClass("is-hidden")):(u.setAttribute("href",a),u.removeClass("is-hidden"));else{t.updateNavLinks(s,f,l,a),c=t.subviews["photo-well-media-view"].getCanvasSize();for(v=0;v<i;v++){if(!n[o][v])break;p=n[o][v].getSizeToFit(c,{includeSizes:["sq","q","t","s","n"]}),p&&p.url&&(d=new Image,d.src=p.url)}for(v=0;v<r;v++){if(!n[o][v])break;p=n[o][v].getSizeToFit(c),p&&p.url&&(d=new Image,e.LH.mark("mark_time_to_load_photo_only_start"),d.onload=function(){e.LH.mark("mark_time_to_load_photo_only");var t=e.LH.measure("time_to_load_photo_only",{startMark:"mark_time_to_load_photo_only_start",endMark:"mark_time_to_load_photo_only"});!YUI.Env.isServer&&e.config.win.beaconError&&window.beaconError("time_to_load_photo_only",window.location.href,{duration:t.duration})},d.src=p.url)}}}t.appContext.adManager.updateContext({prev:n.previous[0],current:t.get("photo"),next:n.next[0],type:t.contextData.modelName}),s(h,"next"),s(c,"previous"),t.animateNavigation(),t.isAd&&t.appContext.adManager.markAdAsSeen()},function(e){if(e.notInContext||e.code===99)return t.get("contextModel").setValue("photoContextList",[]),t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.activate();throw e}).then(null,function(e){n.warn("There was a problem initializing the next/previous controls.",{err:e})}),this.attachKeyEvent("down:37,75,39,74",t.handlePrevNextKeys.bind(t)),this.get("photo").getValue("isOwner")||this.appContext.getViewCounter().queue(this.get("photo").getValue("id"),this.publisherUrl||this.appContext.getReferrer())),u={":ad":t.setLinkAsAdFriendly},t.attachEvents(u),this},setupNavLink:function(t,r,i){var s=this.get("container").all(r),o,u;if(!t&&s.size()){s.remove();return}o=t,u=e.URLHelper.getPhotoPage({photoId:o.getValue("id"),pathAlias:o.getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextModel").getValue("urlSuffix"),lightbox:this.appContext.experiments.fullscreen.getMode()});if(!u||u==="#"){n.warn("Invalid next/prev URL",{url:u}),s.remove();return}return u},updateNavLinks:function(e,t,n,r){var i=this.get("container").all(e);i.setAttribute("href",t+"//"+n+r),this.firstLoad&&i.removeClass("is-hidden")},destructor:function(){clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout),this.movingTimeout=null,this.initialTimeout=null},handleFeedbackClick:function(t){if(t.target.ancestor(".ui-dialog",!0))return;t.halt(),this.feedbackDialog.toggle(),e.rapidTracker.beacon(this.name,"helpFeedbackMenuClick")},handlePrevNextKeys:function(t){var r=this,i,s,o,u=50;if(t.button===37||t.button===75)s=".navigate-prev",o="previous",e.rapidTracker.beacon(this.name,"prevPhotoKeyPress");else if(t.button===39||t.button===74)s=".navigate-next",o="next",e.rapidTracker.beacon(this.name,"nextPhotoKeyPress");s&&r.get("container").one(s)&&(t.preventDefault(),i=r.get("container").one(s).getAttribute("href"),i&&i!=="#"&&(r.keyboardNavigation&&r.keyboardNavigation.url&&i===r.keyboardNavigation.url&&(new Date).getTime()-r.keyboardNavigation.time<u?n.log("Ignoring duplicate keyboard navigation",{url:i}):(r.keyboardNavigation={url:i,time:(new Date).getTime()},this.appContext.adManager.setAdCouldBeShown(!0,o,i),r.appContext.flapp.navigate(i))))},handleContextMenu:function(e){e.preventDefault(),this.fire("subviewViewEvent","rightClickPhoto")}})},"@VERSION@",{requires:["yui-throttle","flickr-view","hermes-template-photo-well","url-helper","better-throttle","hermes-template-reboot-welcome-dialog-content","hermes-template-photo-opt-out"],optional:["photo-well-media-view","photo-models","photo-route"],langBundles:["common"]});
YUI.add("photo-privacy-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r;return r={photo_id:t,is_public:this.getValue(t,"isPublic"),is_friend:this.getValue(t,"isVisibleByFriends"),is_family:this.getValue(t,"isVisibleByFamily"),perm_addmeta:this.getValue(t,"permAddMeta"),perm_comment:this.getValue(t,"permComment")},e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)},batchUpdate:function(t,n){var r;switch(!0){case"privacy"in n&&"commenting"in n&&"addMeta"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_addmeta:n.addMeta,perm_comment:n.commenting};break;case"privacy"in n&&"commenting"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_comment:n.commenting};break;case"privacy"in n&&"addMeta"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_addmeta:n.addMeta};break;case"commenting"in n&&"addMeta"in n:r={photo_ids:t,perm_addmeta:n.addMeta,perm_comment:n.commenting};break;case"privacy"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily};break;case"commenting"in n:r={photo_ids:t,perm_comment:n.commenting};break;case"addMeta"in n:r={photo_ids:t,perm_addmeta:n.addMeta}}return r.full_response=1,e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)}},attributes:{isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},permAddMeta:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permComment:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]});
YUI.add("flickr-photos-getPerms-fetcher",function(e,t){"use strict";function n(e,t){var n=e[0],r=e[1],i;i={id:t.id,isPublic:n.perms.ispublic,isVisibleByFriends:n.perms.isfriend,isVisibleByFamily:n.perms.isfamily,permAddMeta:n.perms.permaddmeta,permComment:n.perms.permcomment},r.addOrUpdate(i)}function r(n,r){var i=n.id,s={photo_id:i},o=this;return e.Promise.all([r.callAPI("flickr.photos.getPerms",s),r.getModelRegistry("photo-privacy-models")]).then(function(e){return o._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});
YUI.add("hermes-lang-client-app_fr-fr",function(e,t){e.Intl.add("hermes/client-app","fr-FR",{SAVING_LAST_ACTIONS:["Attention\u00a0! L\u2019enregistrement de vos derni\u00e8res actions est toujours en cours. Vous risquez de les perdre en quittant cette page."],UPLOAD_IN_PROGRESS:["Attendez\u00a0! Vos photos sont encore en route vers nos serveurs. Elles risquent de ne jamais les atteindre si vous quittez cette page maintenant."]})},"@VERSION@",{requires:["intl"]});
